\chapter{Part 1}
%â€¢ REPORT â€“ Part 1

\section{Introduction}
%â€¢ Very brief introduction of the overall problem setting (< page
%max)

\section{Response Time analysis}
\subsection{Fixed-Priority Non-Preemptive}
CAN messages follow fixed-priority non-preemptive protocol. The response time analysis for fixed-priority non-preemptive messages can be computed as follows.

\subsubsection{BlockingTime}
Blocking time of a message is defined as the time period for which the message can be blocked by a lower priority message. Therefore blocking time can be computed by finding the maximum of execution of times of all the messages having lower priority than the current message. It can be computed as shown in equation \ref{eq:block}.

\begin{equation}
B_{mi}=\max_{k\epsilon lp(m_i)}(c_i) 
\label{eq:block}
\end{equation}

\subsubsection{BusyPeriod}
Busy Period is defined as the maximum time at which the execution of the message gets completed. It includes the blocking time, delay due to execution of higher priority messages and the message execution time. Busy period of message $m_i$ with priority $i$ can be computed from the equation \ref{eq:busy} with initialization condition shown in equation \ref{eq:init} and termination condition as shown in equation \ref{eq:ter}. 

\begin{equation}
 t_{mi}^{k+1}=B_{mi}+\sum_{\forall m\epsilon hp(m_i)\cup m_i} \lceil{\frac{t_{mi}^k}{p_m}}\rceil c_mi
\label{eq:init}
\end{equation}


\begin{equation}
t_{mi}^0=c_{mi}
\label{eq:ter}
\end{equation}

\begin{equation}
t_{mi}^{k+1}=t_{mi}^{k}
\label{eq:busy}
\end{equation}

\subsubsection{ResponseTime}
If the busy period of the message is less than the period of the message, then the response time of the message is equal to busy period. But if busy period is greater than the period of the message, multiple messages arrive in this instance and response time is computed as the maximum of response times of each individual instances. The number of instances can be computed from equation \ref{eq:inst}. The waiting time and response time of instance $q$ can be computed using equations \ref{eq:wm} and equation \ref{eq:resp} respectively. The initialization and termination conditions for each instance are governed by equations \ref{eq:initw}and \ref{eq:termw} respectively. The total response time can be computed using equation \ref{eq:respfinal}. 

\begin{equation}
Q_{mi}=\lceil \frac{t_{mi}}{p_{mi}}\rceil
\label{eq:inst}
\end{equation}


\begin{equation}
w_{mi}^{k+1}(q)=B_{mi}+qc_{mi}+\sum_{\forall m\epsilon hp(m_i)}\lceil \frac{w_{mi}^k(q)+\tau_bit}{p_{m}}c_m \rceil
\label{eq:wm}
\end{equation}

\begin{equation}
R_{mi}(q)=w_{mi}(q)-qp_{mi}+c_{mi}
\label{eq:resp}
\end{equation}
IniTialization and Termination:

\begin{equation}
w_{mi}^{0}(q)=B_{mi}+qc_{mi}
\label{eq:initw}
\end{equation}

\begin{equation}
w_{mi}^{k+1}(q)=w_{mi}^{k}(q)
\label{eq:termw}
\end{equation}

Total Response time of the message:
\begin{equation}
R_{mi}=\max_{q=0toQ_{mi}}(R_{mi}(q)) 
\label{eq:respfinal}
\end{equation}


\subsection{Fixed-Priority Preemptive}
Unlike the above case messages or tasks can be preempted in Fixed-Priority preemptive case. The processors PU1 and PU2 employ FPP for their task management. The response time of FPP can be calculated as below.
\subsubsection{ResponseTime}
The waiting time and response time of each instance can be calculated from equations \ref{eq:wq} and \ref{eq:rq}. The initialization and termination conditions for each task can be obtained from equations \ref{eq:inw} and \ref{eq:termr}. The response time is nothing but the settling value of the response time.  


\begin{equation}
w_{mi}^{k+1}(q)=w_{mi}^{k}(q)+\sum_{\forall m\epsilon hp(m_i)}\lceil \frac{R_{mi}^k(q)}{p_{m}}c_m \rceil
\label{eq:wq}
\end{equation}

\begin{equation}
R_{mi}(q)=w_{mi}(q)+c_{mi}
\label{eq:rq}
\end{equation}
IniTialization and Termination:

\begin{equation}
w_{mi}^{0}(q)=0;
\label{eq:inw}
\end{equation}

\begin{equation}
R_{mi}^{k+1}(q)=R_{mi}^{k}(q)
\label{eq:termr}
\end{equation}




\subsubsection{ResponseTime}

\subsection{Response time analysis per processing unit}

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
	\centering
	\caption{By running the Matlab script ResponsetimeAnylsis\_FPP.m with the different parameters given for PU1 and PU2 these response times are obtained for each of the tasks. These files are then delivered as PU1.m PU2.m}
	\begin{tabular}{rrrrr}
		& & & & \\
		\toprule
		PU1     & $T_1$    & $T_2$    & $T_3$    & $T_4$  $(T_s)$ \\
		\midrule
		Matlab (ms)      & 0.1     & 2.1     & 4.1     & 7.2 \\
		
		& & & & \\
		\toprule
		PU2     & $T_5$    & $T_6$    & $T_7$    & $T_8$ \\
		\midrule
			Matlab (ms)      & 6       & 3       & 9       & 5 \\
		
	\end{tabular}%
	\label{tab:pu-rt}%
\end{table}%



\subsection{ Response time analysis for the CAN bus messages}

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
	\centering
	\caption{Response times for the CAN bus messages}
	\begin{tabular}{rrrrr}
		\toprule
		CAN     & $m_2$   & $m_1$   & $m_3$   & $m_8$ \\
		\midrule
		Matlab (ms) & 2       & 3       & 4       & 4 \\
		
	\end{tabular}%
	\label{tab:can-rt}%
\end{table}%

\input{sysmodel}


\section{Design decision}
%â€¢ Your design decision and justification.

\section{Results}
%â€¢ Results
Firstly: Response time analysis\\
Secondly: Control system input and output









%â€¢ 3 processors:
%â€¢ PU1: Fixed Priority Preemptive (FPP)
%â€¢ PU2: Fixed Priority Preemptive (FPP)
%â€¢ PU3: CompSOC platform using Time Division Multiplexing (TDM) with a clock
%frequency running @ 100 MHz
%âˆ’ Partition slots: 245904 clock cycles: 2.45904 ms
%âˆ’ CoMik slots: 4096 clock cycles: 40.96 us
%âˆ’ TDM period: 1000000 clock cycles: 10 ms
%âˆ’ 4 Partition slots, 4 CoMik slots
%â€¢ Multiple tasks running on each processor
%â€¢ PU1: T1, T2, T3, Ts
%â€¢ PU2: T5, T6, T7, T8
%â€¢ PU3: S1 (unassigned), S2 (T4), S3 (Tca), S4 (unassigned)
%â€¢ Communication task in all processors has a WCETcom = 0.05 ms
%â€¢ Communication bus : CAN
%â€¢ Transmission of each message over the CAN bus takes 1 ms

%
%â€¢ Design the controller and its implementation such that
%1. The real-time tasks meet their deadlines and end-to-end delay
%requirements. For this assign the priorities in each processor
%and the CAN bus to meet the requirements. You may use the
%response time analysis MATLAB scripts provided with the
%assignment.
%2. Input signal ð•ð• should be designed such that the motor position
%(shatft angle) is ðœ½ðœ½ = ðŸ‘ðŸ‘. ðŸðŸðŸðŸðŸðŸðŸðŸ rad for a maximum available input
%signal is 1 V, and maximum settling time of 400 ms
%3. A design space exploration of system poles which satisfy the
%requirements (input signal, settling time) should be done.
%4. Hint: use the sampled-data model used in the lectures (derive
%the augmented system). Be careful during discretization.

%â€¢ Response time analysis processor PU1 (PU1.m)
%â€¢ Response time analysis processor PU2 (PU2.m)
%â€¢ Response time analysis for CAN messages (CAN.m)
%â€¢ Control design and simulation (Control_p1.m)
%â€¢ A PDF report (a2.pdf)
%â€¢ See details of the report later